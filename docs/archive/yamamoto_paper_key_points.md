# 山本論文（2021）の重要ポイント

## 論文の核心概念

### Block Newton法の本質（式45-46）
同時に解くべき連成問題：
```
∇·{C:ε(δu) + Lδγ} = f_{n+1} - ∇·σ(u,γ)  ... (45) 平衡方程式
M:ε(δu) + Nδγ = -g(u,γ)                   ... (46) 降伏条件
```

### 重要な行列定義（式47-50）
```fortran
C = C^e - C^e:{(2μΔγ/||ξ^tr||)[I - 1/3·1⊗1 - n⊗n]}  ... (47)
L = -C^e:n = -2μn                                       ... (48)
M = 2μn                                                 ... (49)
N = -{2μ + 2/3[H' + K'(γ)]}                           ... (50)
```

## 現在の実装の根本的問題

### 1. 分離型実装の誤り
**論文の要求**：式(51)でδγを消去し、式(52)の単一方程式を解く
```
δγ = -N^{-1}M:ε(δu) - N^{-1}·g     ... (51)
```

**現在の実装**：
- stress_dp_bn.fとphexa8.f間でhistiを介して逐次更新
- これは真のBlock Newton法ではない！

### 2. 応力修正項σ_gの役割（式53）
```
σ_g = -{N^{-1}·g}L     ... (53)
```
論文では、この項を残差力ベクトルに組み込むことが重要

### 3. 収束判定（式77, 79）
```
||R_f||_2 ≤ h_f||F^{ext}||_2  ... (77) 平衡方程式
||R_g||_2 ≤ h_g                ... (79) 降伏条件
```
両方を同時に満たす必要がある

## デバッグに必要な修正

### 修正1：真のBlock Newton構造の実装
```fortran
! stress_dp_bn.fに以下を追加
! BOX 1とBOX 2を正しく実装

! 初回反復（BOX 2）
if(itr.eq.1) then
  ! 論文のBOX 2 STEP 1-3を正確に実装
  deltag = 0.d0
  ! 接線剛性の初期化
endif

! 2回目以降（BOX 1）
if(itr.gt.1) then
  ! δγの更新は要素レベルで静的縮約後
  ! 論文の式(51)に従う
endif
```

### 修正2：デバッグ出力の追加
```fortran
! 各反復でモニタリング
if(idepg.eq.1) then
  write(*,'(A,I3,A,E12.5)') 'Iter:', itr, ' deltag=', deltag
  write(*,'(A,E12.5)') '  ||ξ^tr||=', sqrt(sum(xitr**2))
  write(*,'(A,E12.5)') '  g_val=', g_val
  write(*,'(A,E12.5)') '  N_scalar=', N_scalar
  write(*,'(A,E12.5,A,E12.5)') '  M:ε=', M_eps, ' δγ=', delta_gamma_inc
endif
```

### 修正3：Line Search実装（論文には記載ないが必要）
```fortran
! δγの更新後にチェック
g_new = compute_yield(sig_new)
if(abs(g_new) > abs(g_old)) then
  ! ステップサイズを縮小
  alpha = 0.5d0
  delta_gamma_inc = alpha * delta_gamma_inc
endif
```

## 論文のBox 1手順（セクション3.4、p.2156）

1. **試験弾性応力の計算**
2. **整合パラメータΔγのチェック**
3. **塑性の場合**：
   - 塑性ひずみ更新
   - バックストレス更新
   - 応力更新
   - 応力補正項計算
4. **接線剛性の計算**（式54）

## 論文のBox 2手順（セクション3.5.2、p.2161-2162）

1. **初期化**
2. **初回計算の接線剛性**
3. **反復**：
   - 全体構造の平衡方程式を解く
   - 要素レベルでδγを計算
   - 変数更新
   - Box 1から状態更新

## 数値例からの知見（セクション4）

- カンチレバー梁：BN法はRM法より1-2反復多い
- 穴あき板：同様の傾向
- **重要**：論文でもBN法の反復数は多いが、局所反復が不要

## 結論

現在の実装は論文の手法から大きく逸脱している：
1. 静的縮約が正しく行われていない
2. BOX構造が分散している
3. 収束安定化機構（Line Search等）が欠落

論文に完全準拠するには全面的な再構築が必要。