\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tcolorbox}
\tcbuselibrary{breakable}
\usepackage{geometry}
\geometry{margin=1in}

\newcommand{\tr}{\text{tr}}
\newcommand{\dev}{\text{dev}}

\title{Block Newton Method Algorithms from Yamamoto et al. (2020)}
\author{Transcribed from: Simultaneously iterative procedure based on block Newton method for elastoplastic problems}
\date{Int J Numer Methods Eng. 2021;122:2145â€“2178}

\begin{document}

\maketitle

\section*{Box 1: Procedure of stress update for nonlinear isotropic/kinematic hardening}

\begin{tcolorbox}[colback=gray!10, colframe=black, title=Box 1, breakable]
\textbf{Given:} $\underline{\sigma}_n$, $\gamma_n$, $\underline{\varepsilon}_n$, $d\underline{\varepsilon}_{n+1}$

\vspace{0.3cm}
\textbf{Initialization:}
\[
\mathbf{u}_{n+1}^{(k+1)} = \mathbf{u}_n + \Delta\mathbf{u}^{(k+1)}, \quad \gamma_{n+1}^{(k+1)} = \gamma_n + \Delta\gamma^{(k+1)}
\]

\vspace{0.3cm}
\textbf{Step 1. Compute trial elastic stress.}
\begin{align}
\dev[\boldsymbol{\varepsilon}(\mathbf{u}_{n+1}^{(k+1)})] &= \boldsymbol{\varepsilon}(\mathbf{u}_{n+1}^{(k+1)}) - \frac{1}{3}(\tr[\boldsymbol{\varepsilon}(\mathbf{u}_{n+1}^{(k+1)})])\mathbf{1} \\
\mathbf{s}^{\text{tr}} &= 2\mu \{\dev[\boldsymbol{\varepsilon}(\mathbf{u}_{n+1}^{(k+1)})] - \boldsymbol{\varepsilon}^p(\mathbf{u}_n, \gamma_n)\} \\
\boldsymbol{\xi}^{\text{tr}} &= \mathbf{s}^{\text{tr}} - \boldsymbol{\beta}(\mathbf{u}_n, \gamma_n) \\
\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \frac{\boldsymbol{\xi}^{\text{tr}}}{|\boldsymbol{\xi}^{\text{tr}}|}
\end{align}

\vspace{0.3cm}
\textbf{Step 2. Check consistency parameter} $\Delta\gamma^{(k+1)}$.

\textbf{If} $\Delta\gamma^{(k+1)} > 0$:

\hspace{0.5cm}\textbf{2.1. Plastic case.}

\hspace{0.5cm}\textbf{2.1.1. Update plastic strain, back stress, and stress.}
\begin{align}
\boldsymbol{\varepsilon}^p(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \boldsymbol{\varepsilon}^p(\mathbf{u}_n, \gamma_n) + \Delta\gamma^{(k+1)}\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \\
\alpha(\gamma_{n+1}^{(k+1)}) &= \alpha(\gamma_n) + \sqrt{\frac{2}{3}}\Delta\gamma^{(k+1)} \\
\boldsymbol{\beta}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \boldsymbol{\beta}(\mathbf{u}_n, \gamma_n) + \sqrt{\frac{2}{3}}[H(\alpha(\gamma_{n+1}^{(k+1)})) - H(\alpha(\gamma_n))]\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \\
\boldsymbol{\sigma}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \kappa\tr[\boldsymbol{\varepsilon}(\mathbf{u}_{n+1}^{(k+1)})] + \mathbf{s}^{\text{tr}} - 2\mu\Delta\gamma^{(k+1)}\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \\
\mathbf{s}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \mathbf{s}^{\text{tr}} - 2\mu\Delta\gamma_{n+1}^{(k+1)}\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \\
\boldsymbol{\xi}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \mathbf{s}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) - \boldsymbol{\beta}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})
\end{align}

\hspace{0.5cm}\textbf{2.1.2. Compute stress corrector.}
\begin{align}
g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= |\boldsymbol{\xi}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})| - \sqrt{\frac{2}{3}}[\sigma_Y + K(\gamma_{n+1}^{(k+1)})] \\
\boldsymbol{\sigma}_g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= -\{N^{-1}(\gamma_{n+1}^{(k+1)}) \cdot g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})\}\mathbf{L}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})
\end{align}

\textbf{Else} ($\Delta\gamma^{(k+1)} = 0$):

\hspace{0.5cm}\textbf{2.2. Elastic case.}
\begin{align}
\mathbf{s}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \mathbf{s}^{\text{tr}} \\
\boldsymbol{\xi}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \boldsymbol{\xi}^{\text{tr}}
\end{align}

\hspace{0.5cm}\textbf{2.2.1. Check yield condition.}
\begin{align}
g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) = |\boldsymbol{\xi}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})| - \sqrt{\frac{2}{3}}[\sigma_Y + K(\gamma_{n+1}^{(k+1)})]
\end{align}

\hspace{0.5cm}\textbf{If} $g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) > 0$:
\begin{align}
\boldsymbol{\sigma}_g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) = -\{N^{-1}(\gamma_{n+1}^{(k+1)}) \cdot g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})\}\mathbf{L}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})
\end{align}

\hspace{0.5cm}\textbf{Else} ($g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \leq 0$):
\begin{align}
\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &\equiv 0 \\
g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &\equiv 0 \\
\boldsymbol{\sigma}_g(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &\equiv 0
\end{align}

\vspace{0.3cm}
\textbf{Step 3. Compute tangent moduli.}
\begin{align}
\mathbf{C}^{ep}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) = \mathbf{C}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) - N^{-1}(\gamma_{n+1}^{(k+1)})\mathbf{L}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \otimes \mathbf{M}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})
\end{align}

where:
\begin{align}
\mathbf{C}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= \mathbf{C}^e - \mathbf{C}^e : \left\{\frac{2\mu\Delta\gamma^{(k+1)}}{|\boldsymbol{\xi}^{\text{tr}}|}\left[\mathbf{I} - \frac{1}{3}\mathbf{1} \otimes \mathbf{1} - \mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \otimes \mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)})\right]\right\} \\
\mathbf{L}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= -2\mu\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \\
\mathbf{M}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) &= 2\mu\mathbf{n}(\mathbf{u}_{n+1}^{(k+1)}, \gamma_{n+1}^{(k+1)}) \\
N(\gamma_{n+1}^{(k+1)}) &= -\left\{2\mu + \frac{2}{3}[H' + K'(\gamma_{n+1}^{(k+1)})]\right\}
\end{align}
\end{tcolorbox}

\newpage

\section*{Box 2: Procedure of updating variables in finite element analysis}

\begin{tcolorbox}[colback=gray!10, colframe=black, title=Box 2, breakable]
\textbf{Step 1. Initialize.}
\begin{align}
\Delta\gamma^{(0)} &= 0 \\
g(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= 0 \\
\boldsymbol{\varepsilon}^p(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= \boldsymbol{\varepsilon}^p(\mathbf{u}_n, \gamma_n) \\
\alpha(\gamma_{n+1}^{(0)}) &= \alpha(\gamma_n) \\
\boldsymbol{\beta}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= \boldsymbol{\beta}(\mathbf{u}_n, \gamma_n) \\
\mathbf{n}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= \mathbf{n}(\mathbf{u}_n, \gamma_n)
\end{align}

\vspace{0.3cm}
\textbf{Step 2. Compute tangent moduli for first calculation from equilibrium state.}
\begin{align}
\mathbf{C}^{ep}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) = \mathbf{C}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) - N^{-1}(\gamma_{n+1}^{(0)})\mathbf{L}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) \otimes \mathbf{M}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)})
\end{align}

where:
\begin{align}
\mathbf{C}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= \mathbf{C}^e - \mathbf{C}^e : \left\{\frac{2\mu\Delta\gamma^{(0)}}{|\boldsymbol{\xi}^{\text{tr}}|}\left[\mathbf{I} - \frac{1}{3}\mathbf{1} \otimes \mathbf{1} - \mathbf{n}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) \otimes \mathbf{n}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)})\right]\right\} = \mathbf{C}^e \\
\mathbf{L}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= -2\mu\mathbf{n}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) = -2\mu\mathbf{n}(\mathbf{u}_n, \gamma_n) \\
\mathbf{M}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) &= 2\mu\mathbf{n}(\mathbf{u}_{n+1}^{(0)}, \gamma_{n+1}^{(0)}) = 2\mu\mathbf{n}(\mathbf{u}_n, \gamma_n) \\
N(\gamma_{n+1}^{(0)}) &= -\left\{2\mu + \frac{2}{3}[H' + K'(\gamma_{n+1}^{(0)})]\right\} = -\left\{2\mu + \frac{2}{3}[H' + K'(\gamma_n)]\right\}
\end{align}

\vspace{0.3cm}
\textbf{Step 3. Iterate.}

\textbf{DO UNTIL:} $\{||\mathbf{R}_f||_2 \leq h_f||\mathbf{F}^{\text{ext}}||_2$ \& $||\mathbf{R}_g||_2 \leq h_g\}$ OR $\{||\mathbf{U}||_2 \leq$ TOL \& $||\mathbf{Q}||_2 \leq$ TOL$\}$

\hspace{0.5cm}(TOL is the word employed to set approximate zero.)

\vspace{0.3cm}
$k \leftarrow k + 1$

\vspace{0.3cm}
\textbf{3.1. Compute} $\delta\mathbf{u}^{(k+1)}$ \textbf{to solve equilibrium equation for overall structure.}
\begin{align}
\mathbf{KU} = \mathbf{R}
\end{align}

\vspace{0.3cm}
\textbf{3.2. Compute} $\delta\gamma^{(k+1)}$ \textbf{from} $\delta\mathbf{u}^{(k+1)}$ \textbf{at either material point or element level.}

At material point:
\begin{align}
\delta\gamma^{(k+1)} = -N^{-1}(\gamma_{n+1}^{(k)})\mathbf{M}(\mathbf{u}_{n+1}^{(k)}, \gamma_{n+1}^{(k)}) : \boldsymbol{\varepsilon}(\delta\mathbf{u}^{(k+1)}) - N^{-1}(\gamma_{n+1}^{(k)}) \cdot g(\mathbf{u}_{n+1}^{(k)}, \gamma_{n+1}^{(k)})
\end{align}

At element level (internal variables $\mathbf{q}$; displacements $\mathbf{u}$):
\begin{align}
\mathbf{q} = \mathbf{k}_{qq}^{-1}(\mathbf{r}_g - \mathbf{k}_{qu}\mathbf{u})
\end{align}

\vspace{0.3cm}
\textbf{3.3. Update variables.}
\begin{align}
\Delta\mathbf{u}^{(k+1)} &= \Delta\mathbf{u}^{(k)} + \delta\mathbf{u}^{(k+1)} \\
\Delta\gamma^{(k+1)} &= \Delta\gamma^{(k)} + \delta\gamma^{(k+1)}
\end{align}

\textbf{If} $\Delta\gamma^{(k+1)} < 0$:
\begin{align}
\Delta\gamma^{(k+1)} \equiv 0
\end{align}

\vspace{0.3cm}
\textbf{3.4. Update state variables and stress from Box 1.}

\vspace{0.3cm}
\textbf{3.5. Compute internal force} $\mathbf{F}^{\text{int}}$.
\end{tcolorbox}

\end{document}